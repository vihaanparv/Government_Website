<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Government of India - National Portal Directory</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Updated Font Link: Loading Inter, Cinzel, and Noto Sans -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Cinzel:wght=400;700&family=Noto+Sans:wght=700&display=swap" rel="stylesheet">

    <style>
        /* Setting 'Inter' as the global default font */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        /* Custom class to apply Cinzel (formal, authoritative) for the About section */
        .font-about-panel {
            font-family: 'Cinzel', serif;
        }
        /* Custom class for the header title using the clear Noto Sans font */
        .font-calligraphy-title {
            font-family: 'Noto Sans', sans-serif; /* Using Noto Sans for clarity */
            font-size: 3.5rem; 
            text-shadow: none; /* Removed text shadow for cleaner look */
            font-weight: 700; /* Set to bold Noto Sans */
        }
        @media (max-width: 768px) {
            .font-calligraphy-title {
                font-size: 2.5rem; 
            }
        }

        /* --- Official Government Blue Custom Class --- */
        .bg-govt-blue { background-color: #06038D; }
        .text-govt-blue { color: #06038D; }
        .border-govt-blue { border-color: #06038D; }
        .hover\:bg-govt-blue-dark:hover { background-color: #040260; }
        .hover\:text-govt-blue-dark:hover { color: #040260; }
        .focus\:ring-govt-blue:focus { --tw-ring-color: #06038D; }

        /* --- Saffron Button Classes --- */
        .bg-saffron-btn { background-color: #FF671F; }
        .hover\:bg-saffron-dark:hover { background-color: #d65113; }

        /* --- India Green Button Classes --- */
        .bg-india-green { background-color: #046A38; }
        .hover\:bg-india-green-dark:hover { background-color: #034e29; }
        .focus\:ring-india-green:focus { --tw-ring-color: #046A38; }

        /* --- High Contrast Mode Styles --- */
        body.high-contrast {
            background-color: #000000 !important;
            color: #FFFF00 !important;
        }
        
        /* Force overrides for High Contrast Mode */
        body.high-contrast header,
        body.high-contrast nav,
        body.high-contrast section,
        body.high-contrast footer,
        body.high-contrast div:not(#floatingActions):not(#accessibilityToolbar):not(#favoritesListPanel), 
        body.high-contrast input,
        body.high-contrast select,
        body.high-contrast textarea {
            background-color: #000000 !important;
            background-image: none !important; /* Remove gradients */
            color: #FFFF00 !important;
            border-color: #FFFFFF !important;
            box-shadow: none !important;
        }

        /* Link Colors in High Contrast */
        body.high-contrast a {
            color: #00FFFF !important; /* Cyan for links */
            text-decoration: underline !important;
        }
        body.high-contrast a:hover {
            color: #FFFFFF !important;
        }
        
        /* Ensure Link Cards look like buttons in High Contrast */
        body.high-contrast .link-card a {
            background-color: #000000 !important;
            border: 1px solid #00FFFF !important;
            color: #00FFFF !important;
            text-decoration: none !important;
        }

        /* Buttons in High Contrast */
        body.high-contrast button:not(#accessibilityToggleBtn) {
            background-color: #000000 !important;
            color: #FFFF00 !important;
            border: 2px solid #FFFF00 !important;
        }
        body.high-contrast button:not(#accessibilityToggleBtn):hover {
            background-color: #333333 !important;
        }

        /* Specific text overrides to ensure visibility */
        body.high-contrast .text-gray-600,
        body.high-contrast .text-gray-700,
        body.high-contrast .text-gray-800,
        body.high-contrast .text-gray-900,
        body.high-contrast .text-indigo-200,
        body.high-contrast .text-indigo-600,
        body.high-contrast .text-white,
        body.high-contrast .text-govt-blue {
            color: #FFFF00 !important;
        }
        
        /* Adjust Images in High Contrast */
        body.high-contrast img {
            filter: grayscale(100%) contrast(120%);
            border: 1px solid #fff;
        }

        /* Input Fields */
        body.high-contrast input::placeholder,
        body.high-contrast textarea::placeholder {
            color: #bbbbbb !important;
        }
        
        .loading-dot {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .dot-delay-1 { animation-delay: 0.2s; }
        .dot-delay-2 { animation-delay: 0.4s; }
        
        .lucide-icon {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            vertical-align: middle;
        }
    </style>
</head>
<body class="bg-sky-50 text-gray-800">

    <header class="bg-indigo-900 shadow-xl sticky top-0 z-10 transition-colors duration-300">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            
            <div class="flex items-center space-x-4">
                <a href="https://imgbb.co/L9hV3d7" class="flex-shrink-0">
                   <img src="https://i.ibb.co/ymbMYTsT/emblem.jpg" 
                        alt="National Emblem"
                        class="h-12 w-auto object-contain rounded-md"
                        onerror="this.onerror=null; this.src='https://placehold.co/48x48/667EEA/FFFFFF?text=EMBLEM';">
                </a>
                
                <div class="flex flex-col">
                    <h1 class="text-5xl text-white font-calligraphy-title">
                        Government of India
                    </h1>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <div class="hidden md:flex space-x-6">
                    <a href="#about" class="text-indigo-200 hover:text-yellow-400 font-medium transition duration-150">About</a>
                    <a href="#links" class="text-indigo-200 hover:text-yellow-400 font-medium transition duration-150">Websites</a>
                    <a href="#schemes" class="text-indigo-200 hover:text-yellow-400 font-medium transition duration-150">Schemes</a>
                    <a href="#dynamicSchemeFinder" class="text-indigo-200 hover:text-yellow-400 font-medium transition duration-150">Scheme Finder</a>
                    <a href="#aiAssistant" class="text-indigo-200 hover:text-yellow-400 font-medium transition duration-150">AI Assistant</a>
                </div>

                <div class="md:hidden ml-4">
                    <button class="text-indigo-200 focus:outline-none p-2 rounded-lg hover:bg-indigo-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                        </svg>
                    </button>
                </div>
                
                <a href="https://ibb.co/6y4t00Y" class="flex-shrink-0">
                   <img src="https://i.ibb.co/20bZqcYj/sanskriti-school-pune-logo.jpg" 
                        alt="sanskriti-school-pune-logo" 
                        class="h-12 w-auto object-contain rounded-md">
                </a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <div class="py-4 mb-10"> 
            <input type="text" id="searchInput" onkeyup="filterLinks()" placeholder="Search government portals (e.g., Passport, Income Tax, NREGA)..."
                    class="w-full p-4 text-lg rounded-xl border-2 border-indigo-400 bg-white focus:border-govt-blue focus:ring-2 focus:ring-govt-blue transition duration-200 shadow-xl">
        </div>

        <section id="about" class="mb-16">
            <div id="aboutContent" class="bg-gradient-to-br from-blue-100 to-sky-100 p-8 rounded-lg shadow-xl border-t-4 border-govt-blue font-about-panel transition-colors duration-300">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">The Government of India</h2>
                
                <p class="text-lg text-gray-700 leading-relaxed mb-4">
                    The Government of India (GoI), officially known as the **Union Government**, is the apex governing authority established by the **Constitution of India**. It administers the Union of 28 states and 8 union territories. As per the Preamble, India is a **Sovereign, Socialist, Secular, Democratic Republic**, committed to securing justice, liberty, equality, and fraternity for all its citizens.
                </p>
                
                <p class="text-lg text-gray-700 leading-relaxed">
                    India's polity is often described as **quasi-federal** , featuring a strong central government with powers systematically divided between the Union and State governments, ensuring effective governance across a vast and diverse populace. The seat of the government is located in **New Delhi**.
                </p>
            </div>
        </section>

        <section id="links" class="mb-16">
            <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Official Government Websites & Portals</h2>
            <div class="bg-blue-50 p-8 rounded-xl shadow-inner transition-colors duration-300">
                
                <div id="linksGrid" class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    
                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-national-portal">
                        <div class="flex justify-between items-start">
                             <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">National Portal of India</h3>
                                <p class="text-gray-600 text-sm mb-4">The official portal for information and services across the Union.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-national-portal', 'National Portal of India', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.india.gov.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>
                    
                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-pmo">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Prime Minister of India (PMO)</h3>
                                <p class="text-gray-600 text-sm mb-4">Official website of the Prime Minister's Office.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-pmo', 'Prime Minister of India (PMO)', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.pmindia.gov.in/en/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-president">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">President of India</h3>
                                <p class="text-gray-600 text-sm mb-4">Official website of the President's Secretariat.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-president', 'President of India', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://presidentofindia.nic.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-parliament">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Parliament of India (Sansad)</h3>
                                <p class="text-gray-600 text-sm mb-4">Portal for legislative information (Lok Sabha and Rajya Sabha).</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-parliament', 'Parliament of India (Sansad)', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://sansad.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-supreme-court">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Supreme Court of India</h3>
                                <p class="text-gray-600 text-sm mb-4">The apex judicial body of India.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-supreme-court', 'Supreme Court of India', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://main.sci.gov.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-mygov">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">MyGov.in</h3>
                                <p class="text-gray-600 text-sm mb-4">Citizen engagement platform for direct participation in governance.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-mygov', 'MyGov.in', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.mygov.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-uidai">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">UIDAI (Aadhaar)</h3>
                                <p class="text-gray-600 text-sm mb-4">Portal for Aadhaar registration, download, and verification services.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-uidai', 'UIDAI (Aadhaar)', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://uidai.gov.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-income-tax">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Income Tax Department</h3>
                                <p class="text-gray-600 text-sm mb-4">For e-filing of returns, PAN services, and tax-related information.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-income-tax', 'Income Tax Department', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.incometax.gov.in/iec/foportal/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-digital-india">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Digital India Services</h3>
                                <p class="text-gray-600 text-sm mb-4">Flagship program for transforming India into a digitally empowered society.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-digital-india', 'Digital India Services', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.digitalindia.gov.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-incredible-india">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Incredible India (Tourism)</h3>
                                <p class="text-gray-600 text-sm mb-4">Official website promoting tourism by the Ministry of Tourism.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-incredible-india', 'Incredible India (Tourism)', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.incredibleindia.org/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-passport-seva">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Passport Seva Portal</h3>
                                <p class="text-gray-600 text-sm mb-4">Ministry of External Affairs' portal for passport and related services.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-passport-seva', 'Passport Seva Portal', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.passportindia.gov.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>
                    
                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-scholarship-portal">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">National Scholarship Portal</h3>
                                <p class="text-gray-600 text-sm mb-4">One-stop solution for various scholarship schemes provided by the government.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-scholarship-portal', 'National Scholarship Portal', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://scholarships.gov.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-make-in-india">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">Make in India</h3>
                                <p class="text-gray-600 text-sm mb-4">Initiative to encourage domestic and international companies to manufacture in India.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-make-in-india', 'Make in India', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://www.makeinindia.com/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-e-courts">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">e-Courts Services</h3>
                                <p class="text-gray-600 text-sm mb-4">Information on judicial services, case status, and cause lists across courts.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-e-courts', 'e-Courts Services', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://ecourts.gov.in/ecourts_home/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>
                    
                    <div class="link-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-govt-blue hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="link-mgnrega">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="link-name text-xl text-gray-900 font-bold mb-1">MGNREGA Portal (NREGA)</h3>
                                <p class="text-gray-600 text-sm mb-4">Official website for the Mahatma Gandhi National Rural Employment Guarantee Act.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('link-mgnrega', 'MGNREGA Portal (NREGA)', 'link')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <a href="https://nrega.nic.in/" target="_blank" rel="noopener noreferrer" 
                            class="mt-2 text-center bg-saffron-btn text-white py-2 px-4 rounded-lg hover:bg-saffron-dark transition duration-150 shadow-md font-semibold">
                            Visit Site
                        </a>
                    </div>

                </div>
            </div>
        </section>

        <section id="schemes" class="mb-16">
            <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Flagship Government Schemes & Initiatives</h2>
            <div class="bg-orange-50 p-8 rounded-xl shadow-inner transition-colors duration-300">
                <div class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    
                    <!-- Scheme Card 1: PM-JAY -->
                     <div class="scheme-card bg-white p-6 rounded-xl shadow-lg border-t-4 border-saffron-btn hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="scheme-pm-jay">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl text-gray-900 font-bold mb-2">Pradhan Mantri Jan Arogya Yojana (PM-JAY)</h3>
                                <p class="scheme-desc text-gray-600 text-sm mb-4">World's largest health insurance/assurance scheme fully financed by the government.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('scheme-pm-jay', 'Pradhan Mantri Jan Arogya Yojana', 'scheme')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <div class="flex flex-col space-y-2">
                             <a href="https://pmjay.gov.in/" target="_blank" rel="noopener noreferrer" class="mt-2 text-center text-saffron-btn font-bold hover:text-orange-700 transition duration-150 border border-saffron-btn py-2 rounded-lg hover:bg-orange-50">View Details</a>
                        </div>
                    </div>

                    <!-- Scheme Card 2: Awas Yojana -->
                    <div class="scheme-card bg-white p-6 rounded-xl shadow-lg border-t-4 border-saffron-btn hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="scheme-awas-yojana">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl text-gray-900 font-bold mb-2">Pradhan Mantri Awas Yojana</h3>
                                <p class="scheme-desc text-gray-600 text-sm mb-4">Mission to provide affordable housing to the urban and rural poor.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('scheme-awas-yojana', 'Pradhan Mantri Awas Yojana', 'scheme')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <a href="https://pmaymis.gov.in/" target="_blank" rel="noopener noreferrer" class="mt-2 text-center text-saffron-btn font-bold hover:text-orange-700 transition duration-150 border border-saffron-btn py-2 rounded-lg hover:bg-orange-50">View Details</a>
                        </div>
                    </div>
                    
                    <!-- Scheme Card 3: Swachh Bharat -->
                     <div class="scheme-card bg-white p-6 rounded-xl shadow-lg border-t-4 border-saffron-btn hover:shadow-2xl transition duration-300 flex flex-col justify-between" data-item-id="scheme-swachh-bharat">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl text-gray-900 font-bold mb-2">Swachh Bharat Abhiyan</h3>
                                <p class="scheme-desc text-gray-600 text-sm mb-4">A nation-wide campaign to clean up the streets, roads and infrastructure.</p>
                            </div>
                            <button class="favorite-btn p-2 rounded-full transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" 
                                onclick="toggleFavorite('scheme-swachh-bharat', 'Swachh Bharat Abhiyan', 'scheme')"
                                aria-label="Toggle favorite status" aria-checked="false">
                            </button>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <a href="https://swachhbharatmission.gov.in/" target="_blank" rel="noopener noreferrer" class="mt-2 text-center text-saffron-btn font-bold hover:text-orange-700 transition duration-150 border border-saffron-btn py-2 rounded-lg hover:bg-orange-50">View Details</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dynamic Scheme Finder Section -->
        <section id="dynamicSchemeFinder" class="mb-16">
            <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">ðŸ§  Dynamic Scheme Finder & Eligibility Check</h2>
            <div id="dynamicSchemeFinderContainer" class="bg-teal-50 p-8 rounded-xl shadow-2xl border-b-4 border-india-green transition-colors duration-300">
                
                <!-- User Profile Input -->
                <h3 class="text-2xl font-bold text-indigo-600 mb-5 flex items-center">
                    <svg class="lucide-icon w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> 
                    Your Profile
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="userAge" class="block text-sm font-medium text-gray-700 mb-1">Age (Years)</label>
                        <input type="number" id="userAge" oninput="validateInput('userAge');" placeholder="e.g., 35"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" min="0">
                    </div>

                    <div>
                        <!-- UPDATED: Currency is now INR -->
                        <label for="userIncome" class="block text-sm font-medium text-gray-700 mb-1">Annual Income (INR)</label>
                        <div class="relative">
                            <!-- UPDATED: Currency symbol to INR (â‚¹) -->
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold">â‚¹</span>
                            <input type="number" id="userIncome" oninput="validateInput('userIncome');" placeholder="e.g., 450000"
                                class="w-full p-3 pl-8 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" min="0">
                        </div>
                    </div>

                    <div>
                        <label for="userLocation" class="block text-sm font-medium text-gray-700 mb-1">Location / State</label>
                        <select id="userLocation" onchange="validateInput('userLocation');"
                            class="w-full p-3 border border-gray-300 rounded-lg appearance-none bg-white focus:ring-indigo-500 focus:border-indigo-500">
                            <!-- Options rendered by JS -->
                        </select>
                    </div>
                </div>

                <!-- Action Button -->
                <div class="flex flex-col sm:flex-row justify-center gap-4 border-t border-teal-200 pt-6">
                    <button id="resetButton" onclick="resetForm()"
                        class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition duration-150 shadow-sm">
                        Clear Data
                    </button>
                    <button id="checkEligibilityButton" onclick="runEligibilityCheck()" disabled
                        class="px-6 py-3 rounded-lg text-white font-bold transition duration-300 bg-indigo-400 cursor-not-allowed flex items-center justify-center shadow-md">
                        <svg class="lucide-icon w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 21-4.3-4.3"/><path d="M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/></svg>
                        Check Eligibility for All
                    </button>
                </div>
                
                <!-- Eligibility Message -->
                <p id="validationMessage" class="mt-4 text-center text-sm text-red-500 font-medium hidden">
                    Please fill in all fields (Age, Income, and Location) to run the check.
                </p>

                <!-- Scheme List Output -->
                <div class="mt-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Available Schemes</h3>
                    <div id="schemeListOutput" class="space-y-4">
                        <!-- Schemes will be rendered here -->
                        <p class="text-center text-gray-500 p-4 bg-white rounded-lg border">
                            Enter your profile details above and click 'Check Eligibility' to see results.
                        </p>
                    </div>
                </div>

            </div>
        </section>


        <section id="aiAssistant" class="mb-16">
            <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">AI Query Assistant (Powered by Gemini)</h2>
            <div class="bg-white p-8 rounded-xl shadow-2xl border-b-4 border-govt-blue transition-colors duration-300">
                <input type="text" id="assistantSearchInput" onkeyup="if(event.key === 'Enter') askAssistant()" placeholder="Ask any query about the Government of India, policies, history, or services..."
                        class="w-full p-4 text-lg rounded-lg border border-indigo-300 focus:border-govt-blue focus:ring-2 focus:ring-govt-blue transition duration-200 shadow-md">
                
                <div class="text-center mt-4">
                     <button onclick="askAssistant()" 
                             class="bg-india-green text-white py-2 px-6 rounded-lg font-semibold hover:bg-india-green-dark transition duration-200 shadow-lg focus:outline-none focus:ring-4 focus:ring-india-green">
                        Get Answer
                    </button>
                </div>

                <div id="assistantResults" class="mt-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg min-h-20 text-gray-600">
                    <p class="text-center font-medium">Type your question above and press 'Get Answer' to use the AI Assistant.</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-indigo-900 text-indigo-200 p-10 mt-12 transition-colors duration-300">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-10">
            <!-- Footer Content -->
             <div>
                <h3 class="text-xl font-bold text-white mb-4">Union Government</h3>
                <p class="text-sm">
                    This portal serves as a directory for the key digital presences of the Government of India, promoting digital access and transparent governance.
                </p>
            </div>
            <div>
                <h3 class="text-xl font-bold text-white mb-4">Key Ministries</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="https://mha.gov.in/" class="hover:text-yellow-400">Ministry of Home Affairs</a></li>
                    <li><a href="https://www.finmin.nic.in/" class="hover:text-yellow-400">Ministry of Finance</a></li>
                    <li><a href="https://www.mea.gov.in/" class="hover:text-yellow-400">Ministry of External Affairs</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-xl font-bold text-white mb-4">Official Sources</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="https://data.gov.in/" class="hover:text-yellow-400">Data.gov.in</a></li>
                    <li><a href="https://www.mygov.in/" class="hover:text-yellow-400">MyGov India</a></li>
                    <li><a href="https://digitalindia.gov.in/" class="hover:text-yellow-400">Digital India</a></li>
                </ul>
            </div>
        </div>
        <div class="border-t border-indigo-700 pt-6 mt-6 text-center text-sm">
            <p>&copy; 2025 Government of INDIA. All rights reserved.</p>
            <p class="mt-2 text-xs text-indigo-400">
                <span class="font-bold">Current User ID:</span> <span id="userIdDisplay" class="font-mono text-xs">Awaiting Auth...</span>
            </p>
        </div>
    </footer>

    <div id="floatingActions" class="fixed bottom-6 right-6 z-50 flex flex-col items-end space-y-3">
        <!-- Favorites List Panel -->
        <div id="favoritesListPanel" class="fixed bottom-24 right-20 w-80 max-h-[70vh] bg-white rounded-xl shadow-2xl p-4 border border-indigo-200 hidden overflow-y-auto z-40 transition-opacity duration-300 transform opacity-0">
            <h3 class="text-xl font-bold text-govt-blue mb-3 border-b pb-2 flex items-center justify-between">
                My Favorites
                <button onclick="toggleFavoritesModal()" class="text-gray-400 hover:text-gray-700">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </h3>
            <div id="favoritesContent" class="space-y-3">
                <!-- Favorites list will be rendered here -->
            </div>
        </div>

        <button id="accessibilityToggleBtn" onclick="toggleAccessibilityToolbar()" title="Toggle Accessibility Tools"
            class="bg-govt-blue text-white font-bold p-3 rounded-full shadow-2xl hover:bg-govt-blue-dark transition duration-300 focus:outline-none flex items-center justify-center">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2c2.76 0 5 2.24 5 5s-2.24 5-5 5-5-2.24-5-5 2.24-5 5-5zm-2 15h4v-3h-4v3zm2 5c-2.76 0-5-2.24-5-5h2c0 1.66 1.34 3 3 3s3-1.34 3-3h2c0 2.76-2.24 5-5 5z"/></svg>
        </button>

        <div id="accessibilityToolbar" class="flex flex-col space-y-2 p-3 bg-white rounded-xl shadow-2xl border border-gray-200 hidden">
            <button onclick="changeFontSize(1)" class="bg-indigo-500 text-white font-bold h-10 w-10 rounded-full shadow-md hover:bg-indigo-600 flex items-center justify-center text-xl">A+</button>
            <button onclick="changeFontSize(-1)" class="bg-indigo-500 text-white font-bold h-10 w-10 rounded-full shadow-md hover:bg-indigo-600 flex items-center justify-center text-xl">A-</button>
            <button onclick="toggleContrast()" class="bg-gray-800 text-white font-bold h-10 w-10 rounded-full shadow-md hover:bg-black flex items-center justify-center text-xl border border-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            </button>
            
            <!-- NEW: Favorites Button -->
            <button id="favoritesBtn" onclick="toggleFavoritesModal()" 
                class="bg-red-500 text-white font-bold h-10 w-10 rounded-full shadow-md hover:bg-red-600 flex items-center justify-center text-xl">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            </button>

        </div>
        <button id="scrollToTopBtn" onclick="scrollToTop()" class="bg-blue-800 text-white p-3 rounded-full shadow-2xl hover:bg-blue-900 hidden">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
        </button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // setLogLevel('debug'); // Uncomment for debugging

        // --- Global Variables (Provided by Canvas) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;
        // State to hold favorited item details: { itemId: { docId: string, name: string, type: string } }
        let favorites = {}; 

        // --- FIREBASE INITIALIZATION & AUTHENTICATION ---
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing.");
                    return;
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Check for custom token and sign in
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('userIdDisplay').textContent = userId;
                        isAuthReady = true;
                        console.log("User signed in. UID:", userId);
                        fetchFavorites();
                    } else {
                        // This case handles sign out or initial anonymous fallback if token failed
                        userId = auth.currentUser?.uid || crypto.randomUUID(); 
                        document.getElementById('userIdDisplay').textContent = userId + " (Anon)";
                        isAuthReady = true; 
                        console.log("User not authenticated, using anonymous/temporary ID:", userId);
                        fetchFavorites();
                    }
                });
            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error);
            }
        }

        // --- FIRESTORE FAVORITES MANAGEMENT ---
        const FAV_COLLECTION_PATH = (uid) => `artifacts/${appId}/users/${uid}/favorites`;

        function updateFavoriteIcons() {
            // Update link cards and scheme cards
            document.querySelectorAll('.link-card, .scheme-card').forEach(card => {
                const itemId = card.getAttribute('data-item-id');
                const favButton = card.querySelector('.favorite-btn');
                if (favButton) {
                    // Check if the key exists in the 'favorites' object
                    const isFavorite = favorites.hasOwnProperty(itemId); 
                    favButton.innerHTML = isFavorite 
                        ? `<svg class="w-5 h-5 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`
                        : `<svg class="w-5 h-5 text-gray-400 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-.318-.318a4.5 4.5 0 00-6.364 0z"/></svg>`;
                    favButton.setAttribute('aria-checked', isFavorite);
                }
            });
        }

        function fetchFavorites() {
            if (!isAuthReady || !userId) return;

            const favsRef = collection(db, FAV_COLLECTION_PATH(userId));
            
            // Set up real-time listener for user's favorites
            onSnapshot(favsRef, (snapshot) => {
                favorites = {}; // Reset state
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    // Store the item ID and the Firestore Document ID, plus name/type for display
                    if (data.itemId) {
                        favorites[data.itemId] = { 
                            docId: doc.id,
                            name: data.itemName,
                            type: data.itemType // 'link' or 'scheme'
                        }; 
                    }
                });
                console.log("Favorites loaded:", Object.keys(favorites).length, "items.");
                updateFavoriteIcons();
                // If the modal is open, re-render the list immediately
                if (document.getElementById('favoritesListPanel').classList.contains('opacity-100')) {
                     renderFavoritesList();
                }

            }, (error) => {
                console.error("Error fetching favorites:", error);
            });
        }

        async function toggleFavorite(itemId, itemName, itemType) {
            if (!userId || !db) {
                // Use a custom modal/message box instead of alert()
                const message = "Authentication is not yet ready. Please wait a moment.";
                console.error(message);
                const resultsDiv = document.getElementById('assistantResults');
                resultsDiv.innerHTML = `<p class="text-center text-red-600 font-medium p-2">${message}</p>`;
                return;
            }
            
            const favsRef = collection(db, FAV_COLLECTION_PATH(userId));
            const favItem = favorites[itemId];
            
            try {
                if (favItem) {
                    // Already favorited, delete it
                    const docRef = doc(db, FAV_COLLECTION_PATH(userId), favItem.docId);
                    await deleteDoc(docRef);
                    // The 'favorites' object will be updated by the onSnapshot listener
                } else {
                    // Not favorited, add it
                    await setDoc(doc(favsRef), {
                        itemId: itemId,
                        itemName: itemName,
                        itemType: itemType, // 'link' or 'scheme'
                        createdAt: new Date().toISOString()
                    });
                    // The 'favorites' object will be updated by the onSnapshot listener
                }
                updateFavoriteIcons(); // Immediate UI feedback (optimistic update)
            } catch (error) {
                console.error("Error toggling favorite status:", error);
            }
        }
        
        // --- Favorites Modal/Panel Logic ---

        function toggleFavoritesModal() {
            const panel = document.getElementById('favoritesListPanel');
            const isOpen = panel.classList.contains('opacity-100');

            if (isOpen) {
                panel.classList.add('opacity-0');
                panel.classList.add('hidden');
                panel.classList.remove('opacity-100');
            } else {
                renderFavoritesList();
                panel.classList.remove('hidden');
                // Use a short timeout to trigger transition
                setTimeout(() => {
                    panel.classList.add('opacity-100');
                    panel.classList.remove('opacity-0');
                }, 10);
            }
        }

        function renderFavoritesList() {
            const contentDiv = document.getElementById('favoritesContent');
            const favKeys = Object.keys(favorites);
            
            if (favKeys.length === 0) {
                contentDiv.innerHTML = `<p class="text-center text-gray-500 italic p-3">You haven't favorited any items yet.</p>`;
                return;
            }

            let html = '';
            
            // Sort by type (Links first, then Schemes)
            const sortedFavorites = favKeys
                .map(key => ({ id: key, ...favorites[key] }))
                .sort((a, b) => {
                    if (a.type === 'link' && b.type === 'scheme') return -1;
                    if (a.type === 'scheme' && b.type === 'link') return 1;
                    return a.name.localeCompare(b.name);
                });


            sortedFavorites.forEach(fav => {
                const isLink = fav.type === 'link';
                const tagColor = isLink ? 'bg-indigo-100 text-indigo-700' : 'bg-orange-100 text-orange-700';

                html += `
                    <div class="border border-gray-200 p-3 rounded-lg flex flex-col hover:bg-gray-50 transition duration-150">
                        <div class="flex justify-between items-start">
                            <span class="font-medium text-gray-800">${fav.name}</span>
                            <span class="text-xs font-semibold ${tagColor} px-2 py-0.5 rounded-full ml-2 uppercase">${fav.type}</span>
                        </div>
                        <div class="mt-2 text-right">
                            <button onclick="toggleFavorite('${fav.id}', '${fav.name}', '${fav.type}')" 
                                class="text-sm text-red-500 hover:text-red-700 focus:outline-none focus:ring-1 focus:ring-red-300 rounded-md">
                                Remove
                            </button>
                        </div>
                    </div>
                `;
            });

            contentDiv.innerHTML = html;
        }


        // --- Accessibility & UI State ---
        const ROOT_ELEMENT = document.documentElement;
        let currentFontSize = 16;
        ROOT_ELEMENT.style.fontSize = `16px`;

        function toggleAccessibilityToolbar() { document.getElementById('accessibilityToolbar').classList.toggle('hidden'); }
        function toggleContrast() { document.body.classList.toggle('high-contrast'); }
        function changeFontSize(direction) {
            let newSize = currentFontSize + (direction * 2);
            if (newSize > 24) newSize = 24; if (newSize < 12) newSize = 12;
            currentFontSize = newSize; ROOT_ELEMENT.style.fontSize = `${currentFontSize}px`;
        }
        window.onscroll = function() {
            const btn = document.getElementById("scrollToTopBtn");
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) btn.classList.remove("hidden");
            else btn.classList.add("hidden");
        };
        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        function filterLinks() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.getElementById('linksGrid').getElementsByClassName('link-card');
            for (let i = 0; i < cards.length; i++) {
                const title = cards[i].querySelector('.link-name').textContent.toLowerCase();
                const desc = cards[i].querySelector('p').textContent.toLowerCase();
                cards[i].style.display = (title.includes(input) || desc.includes(input)) ? 'flex' : 'none';
            }
        }

        // --- Gemini API Setup ---
        const API_KEY = "AIzaSyBeJ0iZ5-DgXv8QXKeIX6PlRKxjNfPBqrQ"; 
        const TEXT_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;

        async function callGeminiApi(url, payload, retries = 0) {
            try {
                const response = await fetch(url, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(response.status);
                return response.json();
            } catch (error) {
                if (retries < 3) {
                    await new Promise(r => setTimeout(r, 1000 * Math.pow(2, retries)));
                    return callGeminiApi(url, payload, retries + 1);
                }
                throw error;
            }
        }

        
        // --- AI Query Assistant (Grounding) ---

        async function askAssistant() {
            const query = document.getElementById('assistantSearchInput').value.trim();
            const container = document.getElementById('assistantResults');
            const button = document.querySelector('#aiAssistant button');

            if (!query) {
                container.innerHTML = `<p class="text-center text-red-600 font-medium">Please enter a question for the AI Assistant.</p>`;
                return;
            }

            button.disabled = true;
            button.innerHTML = `
                <div class="flex items-center space-x-2">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div> 
                    <span>Searching & Generating Answer...</span>
                </div>`;
            container.innerHTML = `<p class="text-center text-gray-500 font-medium">Please wait...</p>`;

            const systemPrompt = "You are a National Government Assistant. Use the provided search results to answer the user's question about the Government of India, policies, schemes, or history accurately and concisely. Maintain an authoritative and informative tone. Always cite your sources at the end.";
            
            const payload = {
                contents: [{ parts: [{ text: query }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const result = await callGeminiApi(TEXT_API_URL, payload);
                const candidate = result.candidates?.[0];
                const text = candidate?.content?.parts?.[0]?.text || "Sorry, I could not find a relevant answer. Please try rephrasing your query.";

                let sourcesHtml = '';
                const groundingMetadata = candidate?.groundingMetadata;
                
                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                    const sources = groundingMetadata.groundingAttributions
                        .map(attribution => ({
                            uri: attribution.web?.uri,
                            title: attribution.web?.title,
                        }))
                        .filter(source => source.uri && source.title);

                    if (sources.length > 0) {
                        sourcesHtml = `<div class="mt-4 pt-4 border-t border-indigo-200">
                                            <p class="font-bold text-sm text-gray-700 mb-2">Sources (for grounding):</p>
                                            <ul class="list-disc pl-5 text-xs space-y-1 text-indigo-700">`;
                        
                        // Limit to top 3 sources for clean display
                        sources.slice(0, 3).forEach((source, index) => {
                            sourcesHtml += `<li><a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="hover:underline">${source.title}</a></li>`;
                        });
                        sourcesHtml += `</ul></div>`;
                    }
                }

                // Simple Markdown to basic HTML for display
                const htmlOutput = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>')
                    .replace(/<br><br>/g, '<p class="mt-2 mb-2">') // Convert double line breaks to paragraphs
                    .replace(/<br>/g, ' '); // Replace single line breaks with space
                
                container.innerHTML = `<div class="text-gray-800 text-base leading-relaxed p-4">${htmlOutput}${sourcesHtml}</div>`;
                container.scrollTop = 0;

            } catch (error) {
                console.error("AI Assistant API call failed:", error);
                container.innerHTML = `<p class="text-center text-red-600 font-medium p-4">Error: Could not connect to the AI Assistant. Please check your network.</p>`;
            } finally {
                button.disabled = false;
                button.innerHTML = 'Get Answer';
            }
        }
        
        // --- Dynamic Scheme Finder Logic ---
        
        const SCHEMES = [
          {
            id: 1,
            name: "Pradhan Mantri Kaushal Vikas Yojana (PMKVY)",
            description: "Skill development scheme to mobilize Indian youth to take up skill training and earn a livelihood.",
            criteria: {
              minAge: 18,
              maxIncome: 0, // No income cap for training access
              location: ["All India"],
            },
            benefit: "Free skill training, certification, and placement assistance.",
          },
          {
            id: 2,
            name: "Mudra Loan Scheme (PMMY)",
            description: "Providing loans up to â‚¹10 lakh to non-corporate, non-farm small/micro-enterprises.",
            criteria: {
              minAge: 18,
              maxIncome: 0, 
              location: ["All India"],
            },
            benefit: "Loans up to â‚¹10 lakh for business establishment/expansion.",
          },
          {
            id: 3,
            name: "National Scholarship Portal (NSP)",
            description: "A centralized platform for various government scholarship schemes for students.",
            criteria: {
              minAge: 15,
              maxIncome: 250000, // Annual Family Income Limit (example in INR)
              location: ["All India"],
            },
            benefit: "Financial aid for higher education/schooling.",
          },
          {
            id: 4,
            name: "Pradhan Mantri Awas Yojana (PMAY-G/U)",
            description: "Affordable housing for Economically Weaker Section (EWS) and Low-Income Group (LIG).",
            criteria: {
              minAge: 21, // Age typically refers to head of family
              maxIncome: 300000, // LIG income limit (example in INR)
              location: ["All India"],
            },
            benefit: "Interest subsidy on home loans or housing unit grant.",
          },
        ];

        const LOCATIONS = [
          'Select Location',
          'Andhra Pradesh', 'Assam', 'Bihar', 'Gujarat', 'Haryana', 
          'Karnataka', 'Kerala', 'Maharashtra', 'New Delhi', 'Tamil Nadu', 
          'Uttar Pradesh', 'West Bengal', 'All India', 'Other/UT',
        ];

        let userProfile = {
            age: null,
            income: null,
            location: null,
        };

        // Renders the Location dropdown options
        function renderLocationOptions() {
            const selectElement = document.getElementById('userLocation');
            if (!selectElement) return;

            selectElement.innerHTML = ''; // Clear existing options
            LOCATIONS.forEach((loc, index) => {
                const option = document.createElement('option');
                option.value = loc;
                option.textContent = loc;
                if (index === 0) {
                    option.disabled = true;
                    option.selected = true;
                }
                selectElement.appendChild(option);
            });
        }
        
        // Validates input fields and toggles the check button state
        function validateInput() {
            const ageInput = document.getElementById('userAge');
            const incomeInput = document.getElementById('userIncome');
            const locationSelect = document.getElementById('userLocation');
            const checkButton = document.getElementById('checkEligibilityButton');
            const validationMessage = document.getElementById('validationMessage');

            // Update user profile object
            userProfile.age = parseInt(ageInput.value) || null;
            // Income is now stored as INR directly
            userProfile.income = parseInt(incomeInput.value) || null; 
            userProfile.location = locationSelect.value === 'Select Location' ? null : locationSelect.value;
            
            const isDataProvided = userProfile.age !== null && userProfile.income !== null && userProfile.location !== null;

            if (isDataProvided) {
                checkButton.disabled = false;
                checkButton.classList.replace('bg-indigo-400', 'bg-indigo-600');
                checkButton.classList.replace('cursor-not-allowed', 'hover:bg-indigo-700');
                validationMessage.classList.add('hidden');
            } else {
                checkButton.disabled = true;
                checkButton.classList.replace('bg-indigo-600', 'bg-indigo-400');
                checkButton.classList.replace('hover:bg-indigo-700', 'cursor-not-allowed');
                // Only show message if the user has interacted
                if (ageInput.value || incomeInput.value || locationSelect.value !== 'Select Location') {
                    validationMessage.classList.remove('hidden');
                }
            }
            
            // Re-render schemes to show current profile state (or default state)
            renderSchemeList(); 
        }

        // Checks eligibility for a single scheme based on the current user profile
        function checkSingleEligibility(scheme) {
            const userAge = userProfile.age;
            const userIncome = userProfile.income; // Now in INR
            const userLocation = userProfile.location;
            
            // If data is incomplete, return null
            if (userAge === null || userIncome === null || userLocation === null) {
                return null; 
            }

            // 1. Age Check
            if (userAge < scheme.criteria.minAge) return false;

            // 2. Income Check (maxIncome is now directly compared to user's INR input)
            if (scheme.criteria.maxIncome > 0 && userIncome > scheme.criteria.maxIncome) {
                return false; 
            }

            // 3. Location Check 
            const isAllIndiaScheme = scheme.criteria.location.includes('All India');
            const isUserInSpecificLocation = scheme.criteria.location.includes(userLocation);

            if (!isAllIndiaScheme && !isUserInSpecificLocation) {
                return false;
            }
            
            return true;
        }

        // Main function to run the eligibility check
        function runEligibilityCheck() {
            if (document.getElementById('checkEligibilityButton').disabled) return;
            
            const checkButton = document.getElementById('checkEligibilityButton');
            checkButton.disabled = true;
            checkButton.innerHTML = `<div class="flex items-center space-x-2"><svg class="lucide-icon w-5 h-5 mr-2 animate-spin" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg><span>Checking...</span></div>`;

            // Simulate loading/API call
            setTimeout(() => {
                renderSchemeList(true); // Re-render with final results
                checkButton.disabled = false;
                checkButton.innerHTML = `<svg class="lucide-icon w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 21-4.3-4.3"/><path d="M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/></svg><span>Check Eligibility for All</span>`;
            }, 700);
        }
        
        // Renders the list of schemes and their eligibility status
        function renderSchemeList(showFinalResult = false) {
            const outputContainer = document.getElementById('schemeListOutput');
            if (!outputContainer) return;

            let htmlContent = '';

            if (!showFinalResult && (userProfile.age === null || userProfile.income === null || userProfile.location === null)) {
                outputContainer.innerHTML = `<p class="text-center text-gray-500 p-4 bg-white rounded-lg border">
                    Enter your profile details above and click 'Check Eligibility' to see results.
                </p>`;
                return;
            }


            SCHEMES.forEach(scheme => {
                const eligibility = checkSingleEligibility(scheme);
                let statusHtml = '';
                let borderClass = 'border-gray-200';

                if (eligibility === true) {
                    statusHtml = `<span class="text-green-600 flex items-center gap-1 font-semibold">
                                    <svg class="lucide-icon w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg> 
                                    Eligible
                                  </span>`;
                    borderClass = 'border-green-500';
                } else if (eligibility === false) {
                    statusHtml = `<span class="text-red-600 flex items-center gap-1 font-semibold">
                                    <svg class="lucide-icon w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg> 
                                    Not Eligible
                                  </span>`;
                    borderClass = 'border-red-500';
                } else {
                     statusHtml = `<span class="text-gray-500 text-sm italic">
                                     Enter profile details to check
                                   </span>`;
                }
                
                // Format the maximum income for display
                const maxIncomeDisplay = scheme.criteria.maxIncome > 0 
                    ? `â‚¹${scheme.criteria.maxIncome.toLocaleString('en-IN')}` 
                    : 'None';


                htmlContent += `
                    <div class="bg-white p-6 rounded-xl shadow-md border-t-4 ${borderClass} hover:shadow-lg transition duration-200">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3">
                            <h3 class="text-xl font-semibold text-gray-900 mb-2 sm:mb-0">${scheme.name}</h3>
                            ${statusHtml}
                        </div>
                        <p class="text-gray-600 mb-4">${scheme.description}</p>
                        
                        <div class="border-t pt-4 grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm">
                            <div class="flex items-center text-gray-700">
                                <span class="text-lg mr-2 text-green-500">â‚¹</span> 
                                <span class="font-medium">Benefit:</span> ${scheme.benefit}
                            </div>
                            <div class="flex items-center text-gray-700">
                                <svg class="lucide-icon w-4 h-4 mr-2 text-blue-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                <span class="font-medium">Age Req:</span> ${scheme.criteria.minAge}+
                            </div>
                            <div class="flex items-center text-gray-700">
                                <svg class="lucide-icon w-4 h-4 mr-2 text-red-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                                <span class="font-medium">Max Income:</span> ${maxIncomeDisplay}
                            </div>
                        </div>
                    </div>
                `;
            });
            outputContainer.innerHTML = htmlContent;
        }

        // Resets the input fields and clears the eligibility results
        function resetForm() {
            document.getElementById('userAge').value = '';
            document.getElementById('userIncome').value = '';
            document.getElementById('userLocation').value = LOCATIONS[0];
            userProfile.age = null;
            userProfile.income = null;
            userProfile.location = null;
            validateInput(); // Re-validates and resets UI state
        }
        
        // Initialization on window load
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            renderLocationOptions();
            validateInput();
        });


        // Expose functions to the global scope for HTML event handlers
        window.toggleAccessibilityToolbar = toggleAccessibilityToolbar;
        window.changeFontSize = changeFontSize;
        window.toggleContrast = toggleContrast;
        window.scrollToTop = scrollToTop;
        window.filterLinks = filterLinks;
        window.askAssistant = askAssistant;
        window.runEligibilityCheck = runEligibilityCheck; 
        window.resetForm = resetForm;
        window.validateInput = validateInput;
        window.toggleFavorite = toggleFavorite; // Exposed for favorite button handler
        window.toggleFavoritesModal = toggleFavoritesModal; // NEW: Exposed for favorites modal
    </script>
</body>
</html>

